# ChIP-Atlas-extraction
A script to extract the ChIP-Atlas metadata and compare with GEO metadata (ChIP-Seq and Human metadata)

# Requiremets

```python > 3.0``` and ```create a env with requirements.txt```

## stand_chip_atlas_fields.py

Stand experimentList.tab to tab separated file, including metadata columns.

This script receives the **experimentList.tab** file from **ChIP-Atlas git**, and an **additional_categories_CA_2022.csv** file to add the metadata info into specific columns. 

The columns list is described bellow:
Experimental_ID	Genome_assembly	Antigen_class	Antigen	Cell_type_class	Cell_type	Cell_type_description	Processing_logs	Title	Metadata	age	biomaterial_type	cell_line	disease	disease_ontology_uri	donor_health_status	donor_health_status_ontology_uri	donor_id	origin_sample_ontology_uri	sample_ontology_uri	sex	sra	tissue_type
- Experimental_ID
- Genome_assembly
- Antigen_class
- Antigen
- Cell_type_class
- Cell_type
- Cell_type_description
- Processing_logs
- Title
- Metadata
- age
- biomaterial_type
- cell_line
- disease
- disease_ontology_uri
- donor_health_status
- donor_health_status_ontology_uri
- donor_id
- origin_sample_ontology_uri
- sample_ontology_uri
- sex
- sra
- tissue_type

### Usage

```
python stand_chip_atlas_fields.py experimentList.tab additional_categories_CA_2022.csv experimentList.tsv
```


## filter_hs_antigen.py

### Usage

A script to generate all desired files related to C-A database(CA_hg38_2022_filter_antigenclass.csv, CA_hg38_Hs_GSM_GSE_2022_antigenclass.csv, Histone_CA_2021.csv) 

You should pass the file generated by **stand_chip_atlas_fields.py**, **GEO_metadata**, the **txt file generate by Extract_GSM script**, and the EpiClass csv output **(test_predict_max_complete.csv)**

```
Command line: python filter_hs_antigen.py experimentList_stand_2023.tsv GEO_metadata_stand.csv extract_gsm/write_out/test_0_2021.txt EpiLaP_total_CA_2021_2021/test_predict_max_complete.csv
```

## merge_epilap_prediction.py
### Usage

Script to merge several EpiLaP.csv files to Histone_CA file generated by filter_hs_antigen.py. The csv files should be in the same folder containing this script.

```
Command line: python merge_metadata_epilap.py Histone_CA.csv
```

# Extract GSM

```
Hint: You should create a output directory to receive the txt file(s) that will be generated during the process (e.g write_out)


A script to recover the GSM IDs related with the SRX IDs.

optional arguments:
  -h, --help            show this help message and exit
  -d DF, --df DF        The absolute path to the csv file with the metadata
                        information containing at least the GSM and SRX
                        columns
  -n NUM, --num NUM     The index number from the list of SRX if necessary to
                        run the script again starting by a specific SRX
  -c CONCAT, --concat CONCAT
                        The absolute path to the txt files generated in the
                        previous run to be concatenated and mapped into a
                        final df
  -w WRITE_OUT, --write_out WRITE_OUT
                        The absolute path to save the txt file if needed
  -o OUTPUT, --output OUTPUT
                        The absolute path to save the final df


```

## get_rep_bio_metadata.py

This scripts calculates the number of biological replicates per series (GSE). When the `donor_id` info is available, the script counts how many different donor_ids are included in a GSE. If not available, the script uses the columns `sex`, `age`, `cell_line`, `biomaterial_type`, `disease` and `donor_health_status` to determine a donor_id.

Additional columns:

- donor_id_count
- gsm_count

### Usage

```
python get_rep_bio_metadata.py CA_hg38_Hs_GSM_GSE.csv
```



## chip_atlas_parse.py

### Usage

```
Merge dataframes

usage: chip_atlas_parse.py [-h] -f FILE -F FILE -o OUT

a script to merge two dataframes keeping all rows

optional arguments:
  -h, --help            show this help message and exit
  -f FILE, --file FILE  first csv file to be loaded. This file will be the
                        major df to the merge command
  -F FILE, --FILE FILE  second csv file to be loaded and merged with the first
                        one
  -o OUT, --out OUT     Path to save the merged csv file with the new columns
```

## count_srx_geo_chipatlas.py

### Usage

```
Get exclusive ChIP-Atlas SRX

python count_srx_geo_chipatlas.py geo_metadata.csv experimentList.tsv
```


## get_hg19_hg38.py

### Usage

```
Check if each sample has a bigwig for each assembly (hg38 and hg19). These information it will be added into new columns in the final dataframe.

python get_hg19_hg38.py experimentList_stand.tsv GEodiff_nodiff_2021_merged_histones_EpiLaP.tsv output.tsv
```

# Download dir - scripts to download ChIP-Atlas samples (bigwigs)

## write_submiter_downl.py

### Usage

```
Hint: it is advisible to use lists containing 10 SRX each. If you have a big list (i.e 2k samples), you can split it using 'split --verbose -l10 list-srx.txt list-srx.txt.a'.

usage: write_submiter_downl.py [-h] -p PATH -o OUT

A tool to write .sh files using SRX list from a specific path to download each sample using wget

optional arguments:
  -h, --help            show this help message and exit
  -p PATH, --path PATH  Absolute path to the SRX lists (.txt)
  -o OUT, --out OUT     Absolute path to .sh outputs
  ```

## big_submitter.py

### Usage

```
Hint: You shoud to forward the output to your main.sh file. 
Example: python big_submitter.py -p <dir_sh> > main.sh

usage: big_submitter.py [-h] -p PATH

A tool to write a main.sh file to submit each .sh generated by
writer_submitter_downl.py with an interval of 15 seconds

optional arguments:
  -h, --help            show this help message and exit
  -p PATH, --path PATH  Absolute path to the .sh dir
  ```


  # Get cctrol cell line dir - script to find possible(s) control for an IP sample searching for the same cell line.

```
usage: get_cellline.py [-h] -f FILE -d DATAFRAME -o OUT

a script to select inputs related with the same cell line

optional arguments:
  -h, --help            show this help message and exit
  -f FILE, --file FILE  list of SRX of interest
  -d DATAFRAME, --dataframe DATAFRAME
                        ChIP-Atlas metadata filtered by Homo sapiens
  -o OUT, --out OUT     Path to save the csv file

  ``` 

  # writer_json

```
Hint: You shoud to forward the output to your .json file. 
Example: python write_json_CA.py -m CA_metadata.csv -s srx.txt > metadata.json

usage: writer_json_CA.py [-h] -m METADATA -s SRX

A scrip to print a json file for EpiLaP/epiGeEC from the ChIP-Atlas metadata
information

optional arguments:
  -h, --help            show this help message and exit
  -m METADATA, --metadata METADATA
                        path to ChIP-Atlas metadata file (csv)
  -s SRX, --srx SRX     path to SRX txt file
  ```


# add_json_key.py

```
A script to add new keys to C-A json file (EpiLaP)

Command line: python add_json_key.py CA_hg38_Hs_GSM_GSE_2022_antigenclass.csv merged_C-A.json
```
